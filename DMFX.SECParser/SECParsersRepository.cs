using System;
using System.Collections.Generic;
using System.ComponentModel.Composition;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using DMFX.Interfaces;
using System.ComponentModel.Composition.Hosting;

namespace DMFX.SECParser
{
    [Export("SEC", typeof(IParsersRepository))]
    class SECParsersRepository : IParsersRepository
    {
        CompositionContainer _compContainer = null;
        public SECParsersRepository()
        {
            Init();
        }

        private void Init()
        {
            AggregateCatalog catalog = new AggregateCatalog();

            // adding parsers to catalog
            Prepare10QParsers(catalog);
            Prepare10KParsers(catalog);

            _compContainer = new CompositionContainer(catalog);

        }

        private void Prepare10QParsers(AggregateCatalog catalog)
        {
            var catalog10Q = new TypeCatalog(   typeof(SEC10Q.MMM),
                                                typeof(SEC10Q.ABT),
                                                typeof(SEC10Q.ABBV),
                                                typeof(SEC10Q.ACN),
                                                typeof(SEC10Q.ATVI),
                                                typeof(SEC10Q.AYI),
                                                typeof(SEC10Q.ADBE),
                                                typeof(SEC10Q.AMD),
                                                typeof(SEC10Q.AAP),
                                                typeof(SEC10Q.AES),
                                                typeof(SEC10Q.AET),
                                                typeof(SEC10Q.AMG),
                                                typeof(SEC10Q.AFL),
                                                typeof(SEC10Q.A),
                                                typeof(SEC10Q.APD),
                                                typeof(SEC10Q.AKAM),
                                                typeof(SEC10Q.ALK),
                                                typeof(SEC10Q.ALB),
                                                typeof(SEC10Q.ARE),
                                                typeof(SEC10Q.ALXN),
                                                typeof(SEC10Q.ALGN),
                                                typeof(SEC10Q.ALLE),
                                                typeof(SEC10Q.AGN),
                                                typeof(SEC10Q.ADS),
                                                typeof(SEC10Q.LNT),
                                                typeof(SEC10Q.ALL),
                                                typeof(SEC10Q.GOOG),
                                                typeof(SEC10Q.MO),
                                                typeof(SEC10Q.AMZN),
                                                typeof(SEC10Q.AEE),
                                                typeof(SEC10Q.AAL),
                                                typeof(SEC10Q.AEP),
                                                typeof(SEC10Q.AXP),
                                                typeof(SEC10Q.AIG),
                                                typeof(SEC10Q.AMT),
                                                typeof(SEC10Q.AWK),
                                                typeof(SEC10Q.AMP),
                                                typeof(SEC10Q.ABC),
                                                typeof(SEC10Q.AME),
                                                typeof(SEC10Q.AMGN),
                                                typeof(SEC10Q.APH),
                                                typeof(SEC10Q.APC),
                                                typeof(SEC10Q.ADI),
                                                typeof(SEC10Q.ANDV),
                                                typeof(SEC10Q.ANSS),
                                                typeof(SEC10Q.ANTM),
                                                typeof(SEC10Q.AON),
                                                typeof(SEC10Q.AOS),
                                                typeof(SEC10Q.APA),
                                                typeof(SEC10Q.AIV),
                                                typeof(SEC10Q.AAPL),
                                                typeof(SEC10Q.AMAT),
                                                typeof(SEC10Q.ADM),
                                                typeof(SEC10Q.ARNC),
                                                typeof(SEC10Q.AJG),
                                                typeof(SEC10Q.AIZ),
                                                typeof(SEC10Q.T),
                                                typeof(SEC10Q.ADSK),
                                                typeof(SEC10Q.ADP),
                                                typeof(SEC10Q.AZO),
                                                typeof(SEC10Q.AVB),
                                                typeof(SEC10Q.AVY),
                                                typeof(SEC10Q.BHGE),
                                                typeof(SEC10Q.BLL),
                                                typeof(SEC10Q.BAC),
                                                typeof(SEC10Q.BK),
                                                typeof(SEC10Q.BCR),
                                                typeof(SEC10Q.BAX),
                                                typeof(SEC10Q.BBT),
                                                typeof(SEC10Q.BDX),
                                                typeof(SEC10Q.BRK_B),
                                                typeof(SEC10Q.BBY),
                                                typeof(SEC10Q.BIIB),
                                                typeof(SEC10Q.BLK),
                                                typeof(SEC10Q.HRB),
                                                typeof(SEC10Q.BA),
                                                typeof(SEC10Q.BWA),
                                                typeof(SEC10Q.BXP),
                                                typeof(SEC10Q.BSX),
                                                typeof(SEC10Q.BHF),
                                                typeof(SEC10Q.BMY),
                                                typeof(SEC10Q.AVGO),
                                                typeof(SEC10Q.BF_B),
                                                typeof(SEC10Q.CHRW),
                                                typeof(SEC10Q.CA),
                                                typeof(SEC10Q.COG),
                                                typeof(SEC10Q.CPB),
                                                typeof(SEC10Q.COF),
                                                typeof(SEC10Q.CAH),
                                                typeof(SEC10Q.CBOE),
                                                typeof(SEC10Q.KMX),
                                                typeof(SEC10Q.CCL),
                                                typeof(SEC10Q.CAT),
                                                typeof(SEC10Q.CBG),
                                                typeof(SEC10Q.CBS),
                                                typeof(SEC10Q.CELG),
                                                typeof(SEC10Q.CNC),
                                                typeof(SEC10Q.CNP),
                                                typeof(SEC10Q.CTL),
                                                typeof(SEC10Q.CERN),
                                                typeof(SEC10Q.CF),
                                                typeof(SEC10Q.SCHW),
                                                typeof(SEC10Q.CHTR),
                                                typeof(SEC10Q.CHK),
                                                typeof(SEC10Q.CVX),
                                                typeof(SEC10Q.CMG),
                                                typeof(SEC10Q.CB),
                                                typeof(SEC10Q.CHD),
                                                typeof(SEC10Q.CI),
                                                typeof(SEC10Q.XEC),
                                                typeof(SEC10Q.CINF),
                                                typeof(SEC10Q.CTAS),
                                                typeof(SEC10Q.CSCO),
                                                typeof(SEC10Q.C),
                                                typeof(SEC10Q.CFG),
                                                typeof(SEC10Q.CTXS),
                                                typeof(SEC10Q.CLX),
                                                typeof(SEC10Q.CME),
                                                typeof(SEC10Q.CMS),
                                                typeof(SEC10Q.COH),
                                                typeof(SEC10Q.KO),
                                                typeof(SEC10Q.CTSH),
                                                typeof(SEC10Q.CL),
                                                typeof(SEC10Q.CMCSA),
                                                typeof(SEC10Q.CMA),
                                                typeof(SEC10Q.CAG),
                                                typeof(SEC10Q.CXO),
                                                typeof(SEC10Q.COP),
                                                typeof(SEC10Q.ED),
                                                typeof(SEC10Q.STZ),
                                                typeof(SEC10Q.COO),
                                                typeof(SEC10Q.GLW),
                                                typeof(SEC10Q.COST),
                                                typeof(SEC10Q.COTY),
                                                typeof(SEC10Q.CCI),
                                                typeof(SEC10Q.CSRA),
                                                typeof(SEC10Q.CSX),
                                                typeof(SEC10Q.CMI),
                                                typeof(SEC10Q.CVS),
                                                typeof(SEC10Q.DHI),
                                                typeof(SEC10Q.DHR),
                                                typeof(SEC10Q.DRI),
                                                typeof(SEC10Q.DVA),
                                                typeof(SEC10Q.DE),
                                                typeof(SEC10Q.DLPH),
                                                typeof(SEC10Q.DAL),
                                                typeof(SEC10Q.XRAY),
                                                typeof(SEC10Q.DVN),
                                                typeof(SEC10Q.DLR),
                                                typeof(SEC10Q.DFS),
                                                typeof(SEC10Q.DISCA),
                                                typeof(SEC10Q.DISH),
                                                typeof(SEC10Q.DG),
                                                typeof(SEC10Q.DLTR),
                                                typeof(SEC10Q.D),
                                                typeof(SEC10Q.DOV),
                                                typeof(SEC10Q.DOW),
                                                typeof(SEC10Q.DPS),
                                                typeof(SEC10Q.DTE),
                                                typeof(SEC10Q.DRE),
                                                typeof(SEC10Q.DD),
                                                typeof(SEC10Q.DUK),
                                                typeof(SEC10Q.DXC),
                                                typeof(SEC10Q.ETFC),
                                                typeof(SEC10Q.EMN),
                                                typeof(SEC10Q.ETN),
                                                typeof(SEC10Q.EBAY),
                                                typeof(SEC10Q.ECL),
                                                typeof(SEC10Q.EIX),
                                                typeof(SEC10Q.EW),
                                                typeof(SEC10Q.EA),
                                                typeof(SEC10Q.EMR),
                                                typeof(SEC10Q.ETR),
                                                typeof(SEC10Q.EVHC),
                                                typeof(SEC10Q.EOG),
                                                typeof(SEC10Q.EQT),
                                                typeof(SEC10Q.EFX),
                                                typeof(SEC10Q.EQIX),
                                                typeof(SEC10Q.EQR),
                                                typeof(SEC10Q.ESS),
                                                typeof(SEC10Q.EL),
                                                typeof(SEC10Q.ES),
                                                typeof(SEC10Q.RE),
                                                typeof(SEC10Q.EXC),
                                                typeof(SEC10Q.EXPE),
                                                typeof(SEC10Q.EXPD),
                                                typeof(SEC10Q.ESRX),
                                                typeof(SEC10Q.EXR),
                                                typeof(SEC10Q.XOM),
                                                typeof(SEC10Q.FFIV),
                                                typeof(SEC10Q.FB),
                                                typeof(SEC10Q.FAST),
                                                typeof(SEC10Q.FRT),
                                                typeof(SEC10Q.FDX),
                                                typeof(SEC10Q.FIS),
                                                typeof(SEC10Q.FITB),
                                                typeof(SEC10Q.FE),
                                                typeof(SEC10Q.FISV),
                                                typeof(SEC10Q.FLIR),
                                                typeof(SEC10Q.FLS),
                                                typeof(SEC10Q.FLR),
                                                typeof(SEC10Q.FMC),
                                                typeof(SEC10Q.FL),
                                                typeof(SEC10Q.F),
                                                typeof(SEC10Q.FTV),
                                                typeof(SEC10Q.FBHS),
                                                typeof(SEC10Q.BEN),
                                                typeof(SEC10Q.FCX),
                                                typeof(SEC10Q.GPS),
                                                typeof(SEC10Q.GRMN),
                                                typeof(SEC10Q.IT),
                                                typeof(SEC10Q.GD),
                                                typeof(SEC10Q.GE),
                                                typeof(SEC10Q.GGP),
                                                typeof(SEC10Q.GIS),
                                                typeof(SEC10Q.GM),
                                                typeof(SEC10Q.GPC),
                                                typeof(SEC10Q.GILD),
                                                typeof(SEC10Q.GPN),
                                                typeof(SEC10Q.GS),
                                                typeof(SEC10Q.GT),
                                                typeof(SEC10Q.GWW),
                                                typeof(SEC10Q.HAL),
                                                typeof(SEC10Q.HBI),
                                                typeof(SEC10Q.HOG),
                                                typeof(SEC10Q.HRS),
                                                typeof(SEC10Q.HIG),
                                                typeof(SEC10Q.HAS),
                                                typeof(SEC10Q.HCA),
                                                typeof(SEC10Q.HCP),
                                                typeof(SEC10Q.HP),
                                                typeof(SEC10Q.HSIC),
                                                typeof(SEC10Q.HSY),
                                                typeof(SEC10Q.HES),
                                                typeof(SEC10Q.HPE),
                                                typeof(SEC10Q.HLT),
                                                typeof(SEC10Q.HOLX),
                                                typeof(SEC10Q.HD),
                                                typeof(SEC10Q.HON),
                                                typeof(SEC10Q.HRL),
                                                typeof(SEC10Q.HST),
                                                typeof(SEC10Q.HPQ),
                                                typeof(SEC10Q.HUM),
                                                typeof(SEC10Q.HBAN),
                                                typeof(SEC10Q.IDXX),
                                                typeof(SEC10Q.INFO),
                                                typeof(SEC10Q.ITW),
                                                typeof(SEC10Q.ILMN),
                                                typeof(SEC10Q.IR),
                                                typeof(SEC10Q.INTC),
                                                typeof(SEC10Q.ICE),
                                                typeof(SEC10Q.IBM),
                                                typeof(SEC10Q.INCY),
                                                typeof(SEC10Q.IP),
                                                typeof(SEC10Q.IPG),
                                                typeof(SEC10Q.IFF),
                                                typeof(SEC10Q.INTU),
                                                typeof(SEC10Q.ISRG),
                                                typeof(SEC10Q.IVZ),
                                                typeof(SEC10Q.IRM),
                                                typeof(SEC10Q.JEC),
                                                typeof(SEC10Q.JBHT),
                                                typeof(SEC10Q.SJM),
                                                typeof(SEC10Q.JNJ),
                                                typeof(SEC10Q.JCI),
                                                typeof(SEC10Q.JPM),
                                                typeof(SEC10Q.JNPR),
                                                typeof(SEC10Q.KSU),
                                                typeof(SEC10Q.K),
                                                typeof(SEC10Q.KEY),
                                                typeof(SEC10Q.KMB),
                                                typeof(SEC10Q.KIM),
                                                typeof(SEC10Q.KMI),
                                                typeof(SEC10Q.KLAC),
                                                typeof(SEC10Q.KSS),
                                                typeof(SEC10Q.KHC),
                                                typeof(SEC10Q.KR),
                                                typeof(SEC10Q.LB),
                                                typeof(SEC10Q.LLL),
                                                typeof(SEC10Q.LH),
                                                typeof(SEC10Q.LRCX),
                                                typeof(SEC10Q.LEG),
                                                typeof(SEC10Q.LEN),
                                                typeof(SEC10Q.LVLT),
                                                typeof(SEC10Q.LUK),
                                                typeof(SEC10Q.LLY),
                                                typeof(SEC10Q.LNC),
                                                typeof(SEC10Q.LKQ),
                                                typeof(SEC10Q.LMT),
                                                typeof(SEC10Q.L),
                                                typeof(SEC10Q.LOW),
                                                typeof(SEC10Q.LYB),
                                                typeof(SEC10Q.MTB),
                                                typeof(SEC10Q.MAC),
                                                typeof(SEC10Q.M),
                                                typeof(SEC10Q.MRO),
                                                typeof(SEC10Q.MPC),
                                                typeof(SEC10Q.MAR),
                                                typeof(SEC10Q.MMC),
                                                typeof(SEC10Q.MLM),
                                                typeof(SEC10Q.MAS),
                                                typeof(SEC10Q.MA),
                                                typeof(SEC10Q.MAT),
                                                typeof(SEC10Q.MKC),
                                                typeof(SEC10Q.MCD),
                                                typeof(SEC10Q.MCK),
                                                typeof(SEC10Q.MDT),
                                                typeof(SEC10Q.MRK),
                                                typeof(SEC10Q.MET),
                                                typeof(SEC10Q.MTD),
                                                typeof(SEC10Q.MGM),
                                                typeof(SEC10Q.KORS),
                                                typeof(SEC10Q.MCHP),
                                                typeof(SEC10Q.MU),
                                                typeof(SEC10Q.MSFT),
                                                typeof(SEC10Q.MAA),
                                                typeof(SEC10Q.MHK),
                                                typeof(SEC10Q.TAP),
                                                typeof(SEC10Q.MDLZ),
                                                typeof(SEC10Q.MON),
                                                typeof(SEC10Q.MNST),
                                                typeof(SEC10Q.MCO),
                                                typeof(SEC10Q.MS),
                                                typeof(SEC10Q.MOS),
                                                typeof(SEC10Q.MSI),
                                                typeof(SEC10Q.MYL),
                                                typeof(SEC10Q.NDAQ),
                                                typeof(SEC10Q.NOV),
                                                typeof(SEC10Q.NAVI),
                                                typeof(SEC10Q.NTAP),
                                                typeof(SEC10Q.NFLX),
                                                typeof(SEC10Q.NWL),
                                                typeof(SEC10Q.NFX),
                                                typeof(SEC10Q.NEM),
                                                typeof(SEC10Q.NWS),
                                                typeof(SEC10Q.NEE),
                                                typeof(SEC10Q.NLSN),
                                                typeof(SEC10Q.NKE),
                                                typeof(SEC10Q.NI),
                                                typeof(SEC10Q.NBL),
                                                typeof(SEC10Q.JWN),
                                                typeof(SEC10Q.NSC),
                                                typeof(SEC10Q.NTRS),
                                                typeof(SEC10Q.NOC),
                                                typeof(SEC10Q.NRG),
                                                typeof(SEC10Q.NUE),
                                                typeof(SEC10Q.NVDA),
                                                typeof(SEC10Q.ORLY),
                                                typeof(SEC10Q.OXY),
                                                typeof(SEC10Q.OMC),
                                                typeof(SEC10Q.OKE),
                                                typeof(SEC10Q.ORCL),
                                                typeof(SEC10Q.PCAR),
                                                typeof(SEC10Q.PKG),
                                                typeof(SEC10Q.PH),
                                                typeof(SEC10Q.PDCO),
                                                typeof(SEC10Q.PAYX),
                                                typeof(SEC10Q.PYPL),
                                                typeof(SEC10Q.PNR),
                                                typeof(SEC10Q.PBCT),
                                                typeof(SEC10Q.PEP),
                                                typeof(SEC10Q.PKI),
                                                typeof(SEC10Q.PRGO),
                                                typeof(SEC10Q.PFE),
                                                typeof(SEC10Q.PCG),
                                                typeof(SEC10Q.PM),
                                                typeof(SEC10Q.PSX),
                                                typeof(SEC10Q.PNW),
                                                typeof(SEC10Q.PXD),
                                                typeof(SEC10Q.PNC),
                                                typeof(SEC10Q.RL),
                                                typeof(SEC10Q.PPG),
                                                typeof(SEC10Q.PPL),
                                                typeof(SEC10Q.PX),
                                                typeof(SEC10Q.PCLN),
                                                typeof(SEC10Q.PFG),
                                                typeof(SEC10Q.PG),
                                                typeof(SEC10Q.PGR),
                                                typeof(SEC10Q.PLD),
                                                typeof(SEC10Q.PRU),
                                                typeof(SEC10Q.PEG),
                                                typeof(SEC10Q.PSA),
                                                typeof(SEC10Q.PHM),
                                                typeof(SEC10Q.PVH),
                                                typeof(SEC10Q.QRVO),
                                                typeof(SEC10Q.PWR),
                                                typeof(SEC10Q.QCOM),
                                                typeof(SEC10Q.DGX),
                                                typeof(SEC10Q.RRC),
                                                typeof(SEC10Q.RJF),
                                                typeof(SEC10Q.RTN),
                                                typeof(SEC10Q.O),
                                                typeof(SEC10Q.RHT),
                                                typeof(SEC10Q.REG),
                                                typeof(SEC10Q.REGN),
                                                typeof(SEC10Q.RF),
                                                typeof(SEC10Q.RSG),
                                                typeof(SEC10Q.RMD),
                                                typeof(SEC10Q.RHI),
                                                typeof(SEC10Q.ROK),
                                                typeof(SEC10Q.COL),
                                                typeof(SEC10Q.ROP),
                                                typeof(SEC10Q.ROST),
                                                typeof(SEC10Q.RCL),
                                                typeof(SEC10Q.CRM),
                                                typeof(SEC10Q.SCG),
                                                typeof(SEC10Q.SLB),
                                                typeof(SEC10Q.SNI),
                                                typeof(SEC10Q.STX),
                                                typeof(SEC10Q.SEE),
                                                typeof(SEC10Q.SRE),
                                                typeof(SEC10Q.SHW),
                                                typeof(SEC10Q.SIG),
                                                typeof(SEC10Q.SPG),
                                                typeof(SEC10Q.SWKS),
                                                typeof(SEC10Q.SLG),
                                                typeof(SEC10Q.SNA),
                                                typeof(SEC10Q.SO),
                                                typeof(SEC10Q.LUV),
                                                typeof(SEC10Q.SPGI),
                                                typeof(SEC10Q.SWK),
                                                typeof(SEC10Q.SPLS),
                                                typeof(SEC10Q.SBUX),
                                                typeof(SEC10Q.STT),
                                                typeof(SEC10Q.SRCL),
                                                typeof(SEC10Q.SYK),
                                                typeof(SEC10Q.STI),
                                                typeof(SEC10Q.SYMC),
                                                typeof(SEC10Q.SYF),
                                                typeof(SEC10Q.SNPS),
                                                typeof(SEC10Q.SYY),
                                                typeof(SEC10Q.TROW),
                                                typeof(SEC10Q.TGT),
                                                typeof(SEC10Q.TEL),
                                                typeof(SEC10Q.FTI),
                                                typeof(SEC10Q.TXN),
                                                typeof(SEC10Q.TXT),
                                                typeof(SEC10Q.TMO),
                                                typeof(SEC10Q.TIF),
                                                typeof(SEC10Q.TWX),
                                                typeof(SEC10Q.TJX),
                                                typeof(SEC10Q.TMK),
                                                typeof(SEC10Q.TSS),
                                                typeof(SEC10Q.TSCO),
                                                typeof(SEC10Q.TDG),
                                                typeof(SEC10Q.TRV),
                                                typeof(SEC10Q.TRIP),
                                                typeof(SEC10Q.FOX),
                                                typeof(SEC10Q.TSN),
                                                typeof(SEC10Q.UDR),
                                                typeof(SEC10Q.ULTA),
                                                typeof(SEC10Q.USB),
                                                typeof(SEC10Q.UA),
                                                typeof(SEC10Q.UNP),
                                                typeof(SEC10Q.UAL),
                                                typeof(SEC10Q.UNH),
                                                typeof(SEC10Q.UPS),
                                                typeof(SEC10Q.URI),
                                                typeof(SEC10Q.UTX),
                                                typeof(SEC10Q.UHS),
                                                typeof(SEC10Q.UNM),
                                                typeof(SEC10Q.VFC),
                                                typeof(SEC10Q.VLO),
                                                typeof(SEC10Q.VAR),
                                                typeof(SEC10Q.VTR),
                                                typeof(SEC10Q.VRSN),
                                                typeof(SEC10Q.VRSK),
                                                typeof(SEC10Q.VZ),
                                                typeof(SEC10Q.VRTX),
                                                typeof(SEC10Q.VIAB),
                                                typeof(SEC10Q.V),
                                                typeof(SEC10Q.VNO),
                                                typeof(SEC10Q.VMC),
                                                typeof(SEC10Q.WMT),
                                                typeof(SEC10Q.WBA),
                                                typeof(SEC10Q.DIS),
                                                typeof(SEC10Q.WM),
                                                typeof(SEC10Q.WAT),
                                                typeof(SEC10Q.WEC),
                                                typeof(SEC10Q.WFC),
                                                typeof(SEC10Q.HCN),
                                                typeof(SEC10Q.WDC),
                                                typeof(SEC10Q.WU),
                                                typeof(SEC10Q.WRK),
                                                typeof(SEC10Q.WY),
                                                typeof(SEC10Q.WHR),
                                                typeof(SEC10Q.WFM),
                                                typeof(SEC10Q.WMB),
                                                typeof(SEC10Q.WLTW),
                                                typeof(SEC10Q.WYN),
                                                typeof(SEC10Q.WYNN),
                                                typeof(SEC10Q.XEL),
                                                typeof(SEC10Q.XRX),
                                                typeof(SEC10Q.XLNX),
                                                typeof(SEC10Q.XL),
                                                typeof(SEC10Q.XYL),
                                                typeof(SEC10Q.YUM),
                                                typeof(SEC10Q.ZBH),
                                                typeof(SEC10Q.ZION),
                                                typeof(SEC10Q.ZTS)
                                                );
            catalog.Catalogs.Add(catalog10Q);

        }

        private void Prepare10KParsers(AggregateCatalog catalog)
        {
            var catalog10K = new TypeCatalog(
                // typeof(SEC10K.AAPL)
                );

            catalog.Catalogs.Add(catalog10K);
        }


        public IFilingParser GetParser(string company, string type)
        {
            IFilingParser result = null;

            var parsers = _compContainer.GetExports<IFilingParser>(company);
            if (parsers != null)
            {
                var parser = parsers.FirstOrDefault(p => p.Value.ReportType == type);
                if (parser != null)
                {
                    result = parser.Value;
                }
            }

            return result;
        }
    }
}
